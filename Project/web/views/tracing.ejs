<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="">
    <meta name="author" content="">
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAr27FRCwQ1u5t_eov3j6HKej7hq4SPOvQ&callback=initMap">

    </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
    <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=false&libraries=geometry"></script>

    <!-- Title -->
    <title>God ghost car </title>

    <!-- Vendor CSS -->
    <link rel="stylesheet" href="vendor/bootstrap4/css/bootstrap.min.css">
    <link rel="stylesheet" href="vendor/themify-icons/themify-icons.css">
    <link rel="stylesheet" href="vendor/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="vendor/animate.css/animate.min.css">
    <link rel="stylesheet" href="vendor/jscrollpane/jquery.jscrollpane.css">
    <link rel="stylesheet" href="vendor/waves/waves.min.css">
    <link rel="stylesheet" href="vendor/switchery/dist/switchery.min.css">
    <link rel="stylesheet" href="vendor/morris/morris.css">
    <link rel="stylesheet" href="vendor/jvectormap/jquery-jvectormap-2.0.3.css">

    <!-- Neptune CSS -->
    <link rel="stylesheet" href="css/style.css">

    <!-- HTML5 Shiv and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
		<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->
    <style>
        #map {
            height: 400px;
            width: 100%;
        }
    </style>

</head>

<body class="material-design fixed-sidebar fixed-header skin-default content-appear">
    <div class="wrapper">

        <!-- Preloader -->
        <div class="preloader"></div>

        <!-- Sidebar -->
        <div class="site-overlay"></div>
        <div class="site-sidebar">
            <div class="custom-scroll custom-scroll-light">
                <ul class="sidebar-menu">
                    <li class="menu-title">Main</li>
                    <li>
                        <a href="/home" class="waves-effect  waves-light">
								<span class="s-icon"><i class="ti-anchor"></i></span>
								<span class="s-text"> Positioning</span>
							</a>
                    </li>
                    <li>
                        <a href="/history" class="waves-effect  waves-light">
								<span class="s-icon"><i class="ti-layout-tab"></i></span>
								<span class="s-text">History</span>
							</a>
                    </li>
                    <li>
                        <a href="/tracing" class="waves-effect  waves-light">
								<span class="s-icon"><i class="ti-location-arrow"></i></span>
								<span class="s-text">Tracing</span>
							</a>
                    </li>
                    <li>
                        <a href="/nearby" class="waves-effect  waves-light">
								<span class="s-icon"><i class="ti-location-pin"></i></span>
								<span class="s-text">Nearby</span>
							</a>
                    </li>
                    <li>
						<a href="/sensor" class="waves-effect  waves-light">
								<span class="s-icon"><i class="fa fa-bar-chart"></i></span>
								<span class="s-text">Sensor</span>
							</a>
					</li>
                    <li>
                        <a href="/logout" class="waves-effect  waves-light">
								<span class="s-icon"><i class="fa fa-sign-out"></i></span>
								<span class="s-text">Sign Out</span>
							</a>
                    </li>
                </ul>
            </div>
        </div>

        <!-- Header -->
        <div class="site-header">
            <nav class="navbar navbar-light">
                <div class="navbar-left">
                    <a class="navbar-brand" href="/home">
                        <font color="#1CFFFF" size="5">
                            Car
                        </font>
                    </a>
                    <div class="toggle-button dark sidebar-toggle-first float-xs-left hidden-md-up">
                        <span class="hamburger"></span>
                    </div>
                    <div class="toggle-button-second dark float-xs-right hidden-md-up">
                        <i class="ti-arrow-left"></i>
                    </div>
                    <div class="toggle-button dark float-xs-right hidden-md-up" data-toggle="collapse" data-target="#collapse-1">
                        <span class="more"></span>
                    </div>
                </div>
                <div class="navbar-right navbar-toggleable-sm collapse" id="collapse-1">
                    <div class="toggle-button light sidebar-toggle-second float-xs-left hidden-sm-down">
                        <span class="hamburger"></span>
                    </div>

                    <ul class="nav navbar-nav">
                        <li class="nav-item hidden-sm-down">
                            <a class="nav-link toggle-fullscreen" href="#">
									<i class="ti-fullscreen"></i>
								</a>
                        </li>

                    </ul>
                </div>
            </nav>
        </div>


        <!-- Content -->
        <div class="site-content">
            <div class="content-area py-1">
                <div class="container-fluid">
                    <h4>Tracing</h4>

                    <ol class="breadcrumb no-bg mb-1">
                        <li class="breadcrumb-item"><a href="/home">Home</a></li>
                        <li class="breadcrumb-item active">tracing</li>
                    </ol>

                    <div class="box box-block bg-white">
                        <h5>Tracing</h5>
                        <p class="font-90 text-muted mb-1">Tracing some people</p>
                        <div id="textDiv"></div>
                        <br>
                        <h6>Who you want to trace</h6>
                        <select id="people" name="people" style="display.inline">
                            <% for(var i=0; i<data.length; i++){ %>
                                <% if(data[i].username != suser.username) { %>
                                <option <% if(user == data[i].username) { %> selected="true"<% } %> value="<%=data[i].username %>"><%=data[i].username %></option>
                                <% } %>
                            <% } %>
                        </select>


                        <button type="button" onclick="userchoose()" class="btn btn-danger w-min-sm mb-0-25 waves-effect waves-light">Tracing</button>


                        <div id="map"></div>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container-fluid">
            <div class="row text-xs-center">
                <div class="col-sm-4 text-sm-left mb-0-5 mb-sm-0">
                    2017 © Neptune
                </div>
                <div class="col-sm-8 text-sm-right">
                    <ul class="nav nav-inline l-h-2">
                        <li class="nav-item"><a class="nav-link text-black" href="#">Privacy</a></li>
                        <li class="nav-item"><a class="nav-link text-black" href="#">Terms</a></li>
                        <li class="nav-item"><a class="nav-link text-black" href="#">Help</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>
    </div>

    </div>
    <script>
        function userchoose() {
            var tracepeople = document.getElementById('people').value;
            window.location.href = "/tracing?user=" + tracepeople;
        }
        function trace() {
            console.log('<%= lat %>');
            var tracepeople = document.getElementById('people').value;
            var uluru = new google.maps.LatLng('<%= lat %>', '<%= lng %>');
            var map = new google.maps.Map(document.getElementById('map'), {
                zoom: 16,
                center: uluru
            });
            var marker = new google.maps.Marker({
                position: uluru,
                label: tracepeople,
                map: map
            });

            /*alert(tracepeople + "'s the lastest position");*/

            if (navigator.geolocation) {
                browserSupportFlag = true;
                navigator.geolocation.getCurrentPosition(function (position) {
                    var initialLocation = new google.maps.LatLng(position.coords.latitude,
                        position.coords.longitude);
                    var your_marker = new google.maps.Marker({
                        position: initialLocation,
                        map: map,
                        label: 'You'
                    });
                    var meters = google.maps.geometry.spherical.computeDistanceBetween(
                        marker.getPosition(), your_marker.getPosition());
                    var div = document.getElementById("textDiv");
                    div.textContent = "Your distance with " + '<%= user%>' + " : " + meters /
                        1000 + "Km";
                }, function () {
                    handleNoGeolocation(browserSupportFlag);
                });
            } else {
                browserSupportFlag = false;
                handleNoGeolocation(browserSupportFlag);
            }

            function handleNoGeolocation(errorFlag) {
                if (errorFlag == true) {
                    alert("地圖定位失敗");
                } else {
                    alert("您的瀏覽器不支援定位服務");
                }
                initialLocation = taipei;
                map.setCenter(initialLocation);
            }
        }
        if ('<%= user%>') {
            window.onload = trace();
        }
    </script>

    <!-- Vendor JS -->
    <script type="text/javascript" src="vendor/jquery/jquery-1.12.3.min.js"></script>
    <script type="text/javascript" src="vendor/tether/js/tether.min.js"></script>
    <script type="text/javascript" src="vendor/bootstrap4/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="vendor/detectmobilebrowser/detectmobilebrowser.js"></script>
    <script type="text/javascript" src="vendor/jscrollpane/jquery.mousewheel.js"></script>
    <script type="text/javascript" src="vendor/jscrollpane/mwheelIntent.js"></script>
    <script type="text/javascript" src="vendor/jscrollpane/jquery.jscrollpane.min.js"></script>
    <script type="text/javascript" src="vendor/jquery-fullscreen-plugin/jquery.fullscreen-min.js"></script>
    <script type="text/javascript" src="vendor/waves/waves.min.js"></script>
    <script type="text/javascript" src="vendor/switchery/dist/switchery.min.js"></script>
    <script type="text/javascript" src="vendor/flot/jquery.flot.min.js"></script>
    <script type="text/javascript" src="vendor/flot/jquery.flot.resize.min.js"></script>
    <script type="text/javascript" src="vendor/flot.tooltip/js/jquery.flot.tooltip.min.js"></script>
    <script type="text/javascript" src="vendor/CurvedLines/curvedLines.js"></script>
    <script type="text/javascript" src="vendor/TinyColor/tinycolor.js"></script>
    <script type="text/javascript" src="vendor/sparkline/jquery.sparkline.min.js"></script>
    <script type="text/javascript" src="vendor/raphael/raphael.min.js"></script>
    <script type="text/javascript" src="vendor/morris/morris.min.js"></script>
    <script type="text/javascript" src="vendor/jvectormap/jquery-jvectormap-2.0.3.min.js"></script>
    <script type="text/javascript" src="vendor/jvectormap/jquery-jvectormap-world-mill.js"></script>
    <script type="text/javascript" src="vendor/peity/jquery.peity.js"></script>

    <!-- Neptune JS -->
    <script type="text/javascript" src="neptune-material/js/app.js"></script>
    <script type="text/javascript" src="neptune-material/js/demo.js"></script>
    <script type="text/javascript" src="neptune-material/js/index.js"></script>
</body>

</html>